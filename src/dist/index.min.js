"use strict";var express=require("express"),path=require("path"),bcrypt=require("bcrypt"),multer=require("multer"),mongoose=require("mongoose"),bodyParser=require("body-parser"),collection=require("./config"),Vendor=require("./Vendor"),app=express();app.use(express.json()),app.use(express.urlencoded({extended:!1})),app.set("view engine","ejs"),app.use(express.static("public")),app.get("/",function(e,r){r.render("login")}),app.get("/signup",function(e,r){r.render("signup")}),app.get("/admin",function(e,r){r.render("admin")}),app.get("/home",function(e,r){r.render("home")}),app.get("/verification",function(e,r){r.render("verification")}),app.post("/signup",function(r,n){var t,s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t={name:r.body.username,password:r.body.password,role:r.body.role},e.prev=1,e.next=4,regeneratorRuntime.awrap(collection.findOne({name:t.name}));case 4:if(!e.sent){e.next=9;break}n.send("User already exists. Please choose a different username."),e.next=19;break;case 9:return 10,e.next=12,regeneratorRuntime.awrap(bcrypt.hash(t.password,10));case 12:return s=e.sent,t.password=s,e.next=16,regeneratorRuntime.awrap(collection.insertMany(t));case 16:a=e.sent,console.log(a),n.redirect("/login");case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(1),console.error(e.t0),n.status(500).send("An error occurred during user registration.");case 25:case"end":return e.stop()}},null,null,[[1,21]])}),app.post("/login",function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(collection.findOne({name:r.body.username}));case 3:if(t=e.sent){e.next=8;break}n.send("Username not found"),e.next=12;break;case 8:return e.next=10,regeneratorRuntime.awrap(bcrypt.compare(r.body.password,t.password));case 10:e.sent?n.render("home"):n.send("Wrong password");case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.error(e.t0),n.status(500).send("An error occurred during login.");case 18:case"end":return e.stop()}},null,null,[[0,14]])});var vendorSchema=new mongoose.Schema({businessName:String,description:String,location:String,businessHoursStart:String,businessHoursEnd:String,contact:String,socialMediaLink1:String,socialMediaLink2:String,businessCertificate:String,tin:String,businessPicture:String}),upload=multer({dest:"uploads/"});app.post("/verification",upload.single("businessPicture"),function(r,n){var t,s,a,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=r.body,r.file&&(s=r.file,a=s.buffer.toString("base64"),t.businessPicture=a),o=new Vendor(t),e.next=6,regeneratorRuntime.awrap(o.save());case 6:n.status(200).send("Vendor data saved successfully."),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),n.status(500).send("An error occurred while saving vendor data.");case 13:case"end":return e.stop()}},null,null,[[0,9]])}),app.get("/submitted-vendors",function(e,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Vendor.find({submitted:!0}));case 3:n=e.sent,r.json(n),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching submitted vendors:",e.t0),r.status(500).send("An error occurred while fetching submitted vendors.");case 11:case"end":return e.stop()}},null,null,[[0,7]])}),app.put("/approve-vendor/:id",function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=r.params.id,e.next=4,regeneratorRuntime.awrap(Vendor.findByIdAndUpdate(t,{approved:!0}));case 4:n.status(200).send("Vendor approved successfully."),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error approving vendor:",e.t0),n.status(500).send("An error occurred while approving vendor.");case 11:case"end":return e.stop()}},null,null,[[0,7]])}),app.put("/reject-vendor/:id",function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=r.params.id,e.next=4,regeneratorRuntime.awrap(Vendor.findByIdAndUpdate(t,{approved:!1}));case 4:n.status(200).send("Vendor rejected successfully."),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error rejecting vendor:",e.t0),n.status(500).send("An error occurred while rejecting vendor.");case 11:case"end":return e.stop()}},null,null,[[0,7]])}),app.use(express.json()),app.get("/api/vendors",function(e,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Vendor.find());case 3:n=e.sent,r.json(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r.status(500).json({message:"Error fetching vendors"});case 10:case"end":return e.stop()}},null,null,[[0,7]])});var port=8888;app.listen(port,function(){console.log("Server running on Port: ".concat(port))});
//# sourceMappingURL=index.min.js.map
